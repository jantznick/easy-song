# Data Structure i18n Proposal

## Current Structure

### `data/songs/{videoId}.json`
```json
{
  "videoId": "KU5V5WZVcVE",
  "title": "Song Title",
  "artist": "Artist Name",
  "sections": [
    {
      "title": "Lyrics",
      "lines": [
        {
          "spanish": "Spanish text",
          "english": "English text",
          "explanation": "Explanation text",
          "start_ms": 0,
          "end_ms": 2000
        }
      ]
    }
  ]
}
```

### `data/study/{videoId}.json`
```json
{
  "videoId": "KU5V5WZVcVE",
  "title": "Song Title",
  "artist": "Artist Name",
  "structuredSections": [
    {
      "title": "Intro",
      "sectionExplanation": "Explanation text",
      "lines": [
        {
          "spanish": "Spanish text",
          "english": "English text",
          "explanation": "Line explanation",
          "start_ms": 0,
          "end_ms": 2000
        }
      ]
    }
  ]
}
```

## Proposed Structure

### Changes

1. **Language keys**: Change `spanish`/`english` to language codes (`es`/`en`)
2. **Section titles**: Store as i18n object `{ "en": "Intro", "es": "Introducción", ... }`
3. **Section explanations**: Store as i18n object `{ "en": "...", "es": "...", ... }`
4. **Line explanations**: Keep as single string (already language-specific from AI)

### New `data/songs/{videoId}.json`
```json
{
  "videoId": "KU5V5WZVcVE",
  "title": "Song Title",
  "artist": "Artist Name",
  "sections": [
    {
      "title": {
        "en": "Lyrics",
        "es": "Letra",
        "fr": "Paroles",
        "de": "Texte"
      },
      "lines": [
        {
          "es": "Spanish text",
          "en": "English text",
          "explanation": "Explanation text (in user's language)",
          "start_ms": 0,
          "end_ms": 2000
        }
      ]
    }
  ]
}
```

### New `data/study/{videoId}.json`
```json
{
  "videoId": "KU5V5WZVcVE",
  "title": "Song Title",
  "artist": "Artist Name",
  "structuredSections": [
    {
      "title": {
        "en": "Intro",
        "es": "Introducción",
        "fr": "Introduction",
        "de": "Einleitung"
      },
      "sectionExplanation": {
        "en": "The introduction sets the stage...",
        "es": "La introducción establece el escenario...",
        "fr": "L'introduction établit le décor...",
        "de": "Die Einleitung setzt die Bühne..."
      },
      "lines": [
        {
          "es": "Spanish text",
          "en": "English text",
          "explanation": "Line explanation (in user's language)",
          "start_ms": 0,
          "end_ms": 2000
        }
      ]
    }
  ]
}
```

## Implementation Strategy

### Option 1: Full i18n Objects (Recommended)
- Store all translations in the JSON files
- Frontend/backend selects language at runtime
- No need for separate i18n files per song
- More flexible, can add languages without code changes

### Option 2: i18n Keys + Translation Files
- Store keys like `songs.sections.intro.title`
- Use standard i18n library
- Requires maintaining translation files
- Less flexible, harder to manage per-song translations

**Recommendation: Option 1** - Store translations directly in song files.

## Migration Plan

### Phase 1: Update Scripts
- Modify `generate-analysis.ts` to output new format
- Update `process-lyrics-folder.ts` to generate i18n objects
- Add language detection and translation generation

### Phase 2: Backend API
- Update API endpoints to return language-specific data
- Add language parameter to song endpoints
- Maintain backward compatibility during transition

### Phase 3: Frontend/Mobile
- Update components to use new structure
- Add language selection
- Handle missing translations gracefully

### Phase 4: Migration Script
- Create script to convert existing files
- Batch process all existing songs
- Validate converted data

## Language Support

### Initial Languages
- `es` - Spanish (original)
- `en` - English (primary translation)
- `fr` - French (optional)
- `de` - German (optional)
- `zh` - Chinese (optional)

### Adding Languages
1. Update analysis scripts to generate new language
2. Re-run analysis on existing songs (or batch translate)
3. Frontend automatically supports new language

## Section Title Translations

### Standard Section Titles
These can be pre-defined and reused:

```json
{
  "intro": { "en": "Intro", "es": "Introducción", "fr": "Introduction" },
  "verse": { "en": "Verse", "es": "Estrofa", "fr": "Couplet" },
  "chorus": { "en": "Chorus", "es": "Coro", "fr": "Refrain" },
  "bridge": { "en": "Bridge", "es": "Puente", "fr": "Pont" },
  "outro": { "en": "Outro", "es": "Final", "fr": "Final" },
  "interlude": { "en": "Interlude", "es": "Interludio", "fr": "Interlude" }
}
```

### Custom Section Titles
Song-specific titles (like "Verse 1", "Chorus 2") can be:
1. Generated by AI during analysis
2. Translated using translation API
3. Manually curated

## Section Explanation Translations

### Generation Strategy
1. **AI Generation**: Generate explanation in multiple languages during analysis
2. **Translation API**: Translate existing explanations to new languages
3. **Hybrid**: Generate in primary languages (es/en), translate others

### Quality Considerations
- AI-generated explanations may vary in quality per language
- Translation API may lose nuance
- Consider generating in target language vs translating

## Backward Compatibility

### During Transition
- Support both old (`spanish`/`english`) and new (`es`/`en`) formats
- API can convert old format to new on-the-fly
- Migration script converts files gradually

### After Migration
- Remove old format support
- All files use new structure
- Update documentation

## Example Usage

### Backend API Response
```typescript
// GET /api/songs/:videoId?lang=en
{
  "videoId": "KU5V5WZVcVE",
  "title": "Song Title",
  "sections": [
    {
      "title": "Lyrics",  // Extracted from title.en
      "lines": [
        {
          "text": "English text",  // Extracted from en
          "original": "Spanish text",  // Extracted from es
          "explanation": "Explanation text",
          "start_ms": 0,
          "end_ms": 2000
        }
      ]
    }
  ]
}
```

### Frontend Component
```typescript
const currentLang = 'en';
const sectionTitle = section.title[currentLang] || section.title.en;
const lineText = line[currentLang] || line.en;
const originalText = line.es; // Always show original
```

## Benefits

1. **Scalability**: Easy to add new languages
2. **Flexibility**: Song-specific translations
3. **Performance**: No need for runtime translation lookups
4. **Maintainability**: All translations in one place
5. **Quality**: Can curate translations per song

## Considerations

1. **File Size**: Larger JSON files (acceptable for most songs)
2. **Generation Cost**: More API calls for multi-language generation
3. **Translation Quality**: Need strategy for maintaining quality
4. **Missing Translations**: Need fallback strategy

